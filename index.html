<!DOCTYPE html>
<html>
<head>
	<title>Socket.IO chat</title>
	<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
	<ul id="messages"></ul>
	<form action="">
		<input id="m" autocomplete="off"/><button>Send</button>
	</form>
	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		var		socket = io(),
				isTyping = false,
				name,				//this client's username
				message,
				text,
				textbox,
				msglist;
		$(document).ready(function(){
			msglist = $('#messages');
			textbox = $('#m');
			name = prompt("Please enter your name.");
			console.log(name);
			socket.emit('signin', name);
			socket.on('connection', function(name){
				msglist.append($("<li>" + name + " joined the chat.</li>"));
			});
			socket.on('name taken', function(){
				name = prompt("Sorry, that name is already taken.  Please choose another one.");
				socket.emit('signin', name);
			});
			socket.on('no name', function(){
				name = prompt("Please enter your name.");
				socket.emit('signin', name);
			});
			$('form').submit(function(){
				message = textbox.val();
				isTyping = false;
				socket.emit("finished typing");
				socket.emit('chat message', message);
				textbox.val('');
				return false;
			});
			textbox.on('input', function(event){
				text = event.target.value;
				if(text != "" && !isTyping){
					isTyping = true;
					socket.emit("typing");
				}
				if(text == "" && isTyping){
					isTyping = false;
					socket.emit("finished typing");
				}
			});
			socket.on('type', function(username, id){
				if(username!=name){
					var typeMessage = $("<li id='" + username + "'>" + username + " is typing...</li>");
					msglist.append(typeMessage);
				}
			});
			socket.on('finish typing', function(username, id){
				console.log($("#" + username));
				$("#" + username).remove();
			});
			socket.on('chat message', function(msg, username){
				msglist.append($("<li>" + username + ": " + msg + "</li>"));
			});
			socket.on('leave', function(username){
				msglist.append($("<li>" + username + " disconnected.</li>"));
			});
		});
	</script>
</body>
</html>
